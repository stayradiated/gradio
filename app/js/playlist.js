// Generated by CoffeeScript 1.6.1
(function() {
  var $, Playlist,
    _this = this;

  $ = require('./dom');

  Playlist = (function() {

    Playlist.prototype.elements = {
      'input': '.search',
      'table': 'table tbody'
    };

    Playlist.prototype.events = {
      'keydown .search': 'search',
      'click table': 'play'
    };

    function Playlist(el) {
      var ev, method, name, query, str, _ref, _ref1, _ref2,
        _this = this;
      this.el = el;
      this.display = function(songs) {
        return Playlist.prototype.display.apply(_this, arguments);
      };
      this.search = function(e) {
        return Playlist.prototype.search.apply(_this, arguments);
      };
      _ref = this.elements;
      for (name in _ref) {
        query = _ref[name];
        this[name] = $.find(this.el, query);
      }
      _ref1 = this.events;
      for (str in _ref1) {
        method = _ref1[str];
        _ref2 = str.match(/^(\w+) (.+)$/), str = _ref2[0], ev = _ref2[1], el = _ref2[2];
        $.find(this.el, el).addEventListener(ev, this[method]);
      }
    }

    Playlist.prototype.search = function(e) {
      var query,
        _this = this;
      console.log(e.srcElement);
      if (e.which !== 13) {
        return true;
      }
      query = this.input.value;
      App.getSearchResults(query, 'Songs').then(function(response) {
        return _this.display(response.result);
      });
      return true;
    };

    Playlist.prototype.display = function(songs) {
      var html, i, song, _i, _len;
      html = '';
      for (i = _i = 0, _len = songs.length; _i < _len; i = ++_i) {
        song = songs[i];
        if (i > 10) {
          break;
        }
        console.log(song);
        html += "<tr data-id=\"" + song.SongID + "\">\n  <td>" + song.SongName + "</td>\n  <td>" + song.ArtistName + "</td>\n  <td>" + song.AlbumName + "</td>\n</tr>";
      }
      return this.table.innerHTML = html;
    };

    Playlist.prototype.play = function(e) {
      var tr;
      tr = e.srcElement.parentNode;
      return Player.setSource("http://localhost:8080/song/" + tr.dataset.id + ".mp3");
    };

    return Playlist;

  })();

  module.exports = Playlist;

}).call(this);
